{% extends 'layout.html' %}

{% block content%}
<h1>회원가입 입니다.</h1>
<form action="/signup" method="post">
    <table>
        <tr>
            <td>이메일</td>
            <td><input type="email" id="useremail" name="useremail" placeholder="이메일" onchange="" required></td>
            <td>
                <input type="button" onclick="emailcheck()" value="중복확인"></input>
            </td>
            <td><span id="emailMsg"></span></td>
        </tr>
        <tr>
            <td>비밀번호</td>
            <td><input type="password" name="password" id="pw1" placeholder="비밀번호" onchange="pwcheck()" required></td>
        </tr>
        <tr>
            <td>비민번호 확인</td>
            <td><input type="password" name="password2" id="pw2" placeholder="비밀번호 확인" onchange="pwcheck()" required>
            </td>
            <td><span id="passwordMsg"></span></td>
        </tr>
        <tr>
            <td>이름</td>
            <td><input type="text" name="username" id="username" placeholder="실명" required></td>
        </tr>
        <tr>
            <td>유저코드</td>
            <td><input type="text" name="usercode" placeholder="유저코드"></td>
        </tr>
        <tr>
            <td>핸드폰번호</td>
            <td><input type="text" name="phonenum" id="phonenum" placeholder="'-'없이 입력" onchange="phonecheck()"
                       required></td>
            <td><span id="phoneMsg">axios로 휴대폰번호 양식이 맞는지 문구 출력</span></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td>양식이 다르면 빨간색으로 핸드폰번호를 확인해주세요 같으면 안내X</td>
        </tr>
        <tr>
            <td>코멘트</td>
            <td><input type="text" name="usercomment" placeholder="코멘트"></td>
        </tr>
        <tr>
            <td>
                <button type="submit" onclick="signupCheck()">회원가입</button>
            </td>
        </tr>
    </table>
    <span id="signupMsg">입력문구를 안적은 곳이 있는지 표시해줌</span>
</form>
<script>
    // 이메일 중복 체크
    let useremail = document.querySelector('#useremail');
    let emailCheck = false;
    emailcheck = async () => {
        let emailMsg = document.querySelector('#emailMsg');
        try {
            if (useremail.value !== '') {
                let data = await axios.get(`/signup/emailCheck?useremail=${useremail.value}`);
                console.log(data, '데이터');

                login_flag = data.data.login;
                console.log(login_flag, '로그인플래그');
                if (login_flag) {
                    emailMsg.innerHTML = "사용할수 있는 이메일 입니다.";
                    emailMsg.style.color = 'green';
                    emailCheck = true;
                } else {
                    emailMsg.innerHTML = "이미 존재하는 이메일 입니다."
                    emailMsg.style.color = 'red';
                    emailCheck = false;
                }
            } else {
                emailMsg.innerHTML = "이메일을 입력해주세요";
                emailMsg.style.color = 'red';
            }
        } catch (err) {
            console.error(err);
        }
    }

    // 비밀번호 체크
    let pw1 = document.querySelector('#pw1');
    let pw2 = document.querySelector('#pw2');
    let pwCheck = false;
    pwcheck = () => {
        let passwordMsg = document.querySelector('#passwordMsg');
        if (pw1.value !== '' && pw2.value !== '') {
            if (pw1.value === pw2.value) {
                passwordMsg.innerHTML = "비밀번호가 일치합니다.";
                passwordMsg.style.color = 'green';
                pwCheck = true;
            } else {
                passwordMsg.innerHTML = "비밀번호를 확인해주세요.";
                passwordMsg.style.color = 'red';
                pwCheck = false;
            }
        }
    }

    // 핸드폰번호 체크
    let phoneCheck = false;
    phonecheck = () => {

    }

    // 회원가입 체크
    let username = document.querySelector('#username');
    let phonenum = document.querySelector('#phonenum');
    signupCheck = async () => {
        let signupMsg = document.querySelector('#signupMsg');
        try {
            signupMsg.style.color = 'red';
            if (useremail.value == '') {
                signupMsg.innerHTML = "이메일을 입력해주세요.";
            } else if (emailCheck == false) {
                signupMsg.innerHTML = "이메일 중복확인을 해주세요.";
            } else if (pw1.value == '' || pw2.value == '') {
                signupMsg.innerHTML = "비밀번호를 입력해주세요.";
            } else if (pwCheck == false) {
                signupMsg.innerHTML = "비밀번호가 다릅니다.";
            } else if (username.value == '') {
                signupMsg.innerHTML = "이름을 입력해주세요.";
            } else if (phonenum.value == '') {
                signupMsg.innerHTML = "핸드폰번호를 입력해주세요.";
            } else if (phoneCheck == false) {
                signupMsg.innerHTML = "핸드폰번호를 확인해주세요";
            } else {
                signupMsg.innerHTML = "";
            }


        } catch (err) {
            console.error(err);
        }
    }
</script>
{% endblock %}
